## sec1

- Linux を構成する概念
  - ファイルシステム
  - プロセス
  - ストリーム


``` sh
$ gcc -dumpversion
9

gcc -o hello hello.c

# 警告オプションを全て有効にする。
gcc -o hello -Wall hello.c
```

``` c
// argv の型: char へのポインタの配列
int main(int args, char *argv[])
```

`"` はシェルの機能で、囲んだ部分を1つのコマンドライン引数にまとめる！！

- man コマンド
  - 最初に見つかったセクションのページを表示する
  - ページを指定するには
    - man 3 printf
  - section
    - 1: コマンドらいん
    - 2: システムコール 
    - 3: ライブラリ関数

## sec2

- OS
  - Linux ディストリビューション
    - シェル
    - util-lnux
    - procps
    - GNU coreutils
    - X Window System
    - GNOME, KDE
- UNIX
  - 著作権やライセンスの問題が根深く絡んでいる
  - Linux は UNIX 風 OS の一種だと考えてプログラミングできる
  - 1980
    - System V
    - BSD
      - macOS <- FreeBSD
- Linux の世界 = OS の事、ではない！
  - カーネルが作り出している世界のこと
  - **ルートディレクトリで ls した時のファイルが、カーネルのプログラム本体**
  - Linux とは OS のことだと考えられがちだが、厳密には**カーネルだけを指している**
- デバイスとデバイスドライバ
- システムコール
  - カーネルに頼み込んで仕事を依頼すること
  - ハードウェアとの直接のやり取りなど
  - システムコールこそが Linux カーネルの核心
- ライブラリ関数
  - システムコール以外に使える関数
  - ライブラリに収められているから
  - 関数を貸してもらう作業をリンクという
  - システムコールとの差は曖昧
- libc
  - Linux に用意亜sれているライブラリ
  - 標準 C ライブラリ

``` sh
$ ls /lib/aarch64-linux-gnu/libc.so.6 
/lib/aarch64-linux-gnu/libc.so.6
$ ls -l /lib/aarch64-linux-gnu/libc.so.6 
-rw-r--r-- 1 root root 1641496 Jul  6  2022 /lib/aarch64-linux-gnu/libc.so.6
```

- API
  - C のライブラリの API は関数やマクロ
  - Linux コマンドや設定ファイルが入ることも

## sec3

- ファイルシステム
- ファイルの区別
  - 広義のファイル
    - ディレクトリ
    - シンボリックリンク
    - デバイスファイル
  - 狭義のファイル（regular file）
  - ストリーム
- デバイスの後ろ盾がないデバイスファイル
  - dev null
  - dev zero
  - dev random
- プロセス
  - 動作中のプログラムのこと
  - プログラム
    - ファイルのような形態で存在しているデータも含む
  - 1つのプログラムがあればプロセスは幾つでも作れる
- シグナル
  - Ctrl + C
    - カーネルが該当プロセスに割り込みシグナルを送る
- ストリーム
  - 本書ではバイトストリームのことを指す！
  - バイト列が出たり入ったりするものであれば何でもストリーム！
- パイプ
  - ストリームの両端にプロセスが繋がったもの！！
  - ステップ
    - まず各コマンドを独立したプロセスとして同時に実行する
    - プロセス間をストリームで繋ぐ
- ネットワーク通信
  - ストリームが別のコンピュータにまで伸びたもの
- プロセス間通信
  - ストリーム
  - POSIX IPC
- ３大要素
  - ファイルシステム
    - データに名前をつけて保存する場所
  - プロセス
    - 活動をする主体
  - ストリーム
    - プロセスが他の fs やプロセスとデータをやり取りする手段

``` sh
$ mount -t ext4
/dev/mmcblk0p2 on / type ext4 (rw,relatime)

ps -ef
```

## sec4

- マルチユーザシステム
  - cf: マルチユーザシステムを採用していない
    - 少し前の iOS, Android
    - ログインが省けたり、権限管理も不要
- ディレクトリのパーミッション
  - 読み込み可能の場合、その中のファイル一覧を得られる
  - 書き込み可能の場合、その中に新しいファイルを作成したりできる
  - 実行可能の場合、そのディレクトリの中のファイルにアクセスできる
- クレデンシャル
  - ユーザーAとしてアクセスする = ユーザAの属性を持ったプロセスがアクセスする
    - Linux 上に置いて、活動する主体はユーザではなくプロセス！！！
  - 通常はログインにより証明書が渡される；

``` sh
cat /etc/passwd

cat /etc/group
```

- コマンドらいん
  - シェル
  - 端末
- 端末
  - 黎明期に使われていた端末たテレタイプ
    - 現在のようなディスプレイがなかったため、長い紙に出力されていた
  - ダム端末
  - キャラクタ端末
    - ASCII は元々キャラクタ端末に対する命令として作られていた
  - ビットマップディスプレイ
  - 端末エミュレータ
    - **元々ハードウェアであった端末を、全てソフトウェアにしてしまったもの！**
- 端末も例外なくファイル
  - `/dev/tty0`
  - ファイルとして扱うメリット
    - **表現されているものに接続するためのストリームが得られること！**
- シェル
  - ログイン時に起動されるという点を除くと、ストリームからコマンドを読み込んで実行するプログラムにすぎない！

## sec5

- ファイルディスクリプタ
  - プログラムから見るとただの整数値
  - **カーネルが持ってるストリームを番号と対応づけたもの**
- 3つのストリームがすでに用意されている
  - 標準入力、標準出力、標準エラー出力
- cat コマンドがファイルを意識することはない
- ストリームの読み書き
  - system call read(2)
    - ファイル終端 0
    - エラー発生 -1
  - 人間が読める文字列を格納する場合は `'\0'` で終端するのが習慣
  -  `'\0'` 終端を**前提とする** API
     - printf など
     - read では前提としない 
- ストリームの定義
  - ファイルディスクリプタで表現され read または write で操作できるもののこと
- open
  - flags
    - man 2 open
- close
  - ストリームを始末するシステムコール
- errno 変数
  - 成功なら 0 以上の整数を返す
  - 失敗なら -1 を返す
- perror
  - ライブラリ関数
- ファイルオフセット
  - ストリームをどこまで読んだかの記憶
- dup
  - ファイルディスクリプタを複製するシステムコール

``` sh
gcc -Wall cat.c
```
