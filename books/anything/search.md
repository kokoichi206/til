## sec 1

- 表記揺れ
- ランキング問題
- **転置インデックス**
  - **キーワードごとに**対象となるドキュメントを並べた形式のデータ
- **情報検索**という研究分野
- 検索システム
  - これを実現する1つの方法が全文検索エンジン
- TF: Term Frequency
- IDF: Inverse Document Frequency
- **ベクトル空間モデル**
- **BM25**
  - 検索対象のドキュメントを、検索クエリとの関連度が**確率的に**高い順番に並べる
- 利用者と検索しステmockの相互作用の過程

## sec 2

- **逐次検索**: sequential search
  - grep など
- **転置インデックス**: inverted index
  - 大規模
  - フレーズ検索
    - ある単語が隣り合ってるか、近くにあるか
  - 水平スケールしやすい
- インデクシング
  - 検索エンジンが転置インデックスを構築するプロセスのこと
- テキストデータ以外
  - 絞り込み・ソートなどはできる
  - が、テキスト解析を行わない
  - ソートや集約のために
    - DocValues という列指向フィールドなど
  - 数値や日時データ
    - 範囲・近傍検索に k-dimensional tree
    - 日時も内部的には数値に変換可能
- Apache Lucene
  - **Elasticsearch もこいつをベースとしている**
- Vespa
  - 2017 に OSS 化
  - 更新処理のパフォーマンスの高さ
    - リアルタイム性の求められる検索システム
    - 検索結果ランキングのための様々なフィーチャー
- Groonga
  - 日本発！
  - db とのネイティブなインテグレーションが提供されている

## sec 3

- 転置インデックス
  - 対象となる単語が『ターム』として登録
  - タームがどのドキュメントの何番めかといった情報が『ポスティングリスト』として登録
- **テキスト解析**
  - **どのようなデータをタームとして扱うか**など
  - ステップ
    - 文字の正規化
    - トークン化
    - トークン列に対する各種処理
- 正規化
  - **ステミング**
    - 表記揺れの対策
    - connects, connection -> connect
    - 異なる意味の単語が、同じ語幹になることに注意
      - universal, university -> univers など
  - 記号の取り扱い
    - I'll, use-cases, well-known
- 日本語
  - 形態素解析
    - 単語への分解
    - 品詞の同定
    - 語形変化の解析
    - MeCab, Kuromoji, Sudachi
    - deme
      - 辞書に掲載されてる単語の種類や総数によってトークンがうまく出力されない
      - 長いトークンの一部の文字列で検索したい時に不向き
  - 文字 N-Gram
    - **クエリ側で注意が必要**
      - N 文字以上の単語が入力された場合はフレーズ検索など
      - N=2 の場合、1文字での単語がクエリとして入力されないようにするなど
- Unicode 正規化
  - 等価性の定義
    - 正準等価
      - 視覚的・機能的に等価
    - 互換等価
      - ㌢とセンチなど
      - 全角と半角
  - 出力を統一させる形式
    - NFD: Normalization Form Decomposition
    - ... など4種類定義されている
    - ICU: International Components for Unicode

``` sh
❯ echo -e "\u304B\u3099"
が
❯ echo -e "\u304C"
が
```

- ストップワード
  - a, the, be 動詞
  - **最近では取り除かないことが多い**
    - To be or not to be

## sec 4

- 転置インデックス上でのタームの集合: `bag-of-words`
- ターム集合から構築したポスティングリストを走査する
- ポスティングリスト
  - 3 つのターム "engine", "search", "system", など
- ロジック
  - 転置インデックスを進んでいくイメージを持てた
    - AND 検索
    - OR 検索
  - 一般に **AND の方が OR よりも高速！**
- **ランキング**
  - 各タームのそのドキュメントにおける重要度（重み）
  - **TF-IDF** と呼ばれる重み付け
    - TF: **1つの**ドキュメントで見て、何度も出現するターム
    - IDF: **全体で**見て、少数のドキュメントにしか出現しない希少性の高いターム
  - 今ではより扱いやすい・精度のよい **BM25** が主流になっている
- パフォーマンス
  - みるとこ
    - レイテンシ
    - スループット
  - インデクシング
    - 最もボトルネックになるのは、物理的なディスク I/O
  - MaxScore
    - OR 検索の処理時にポスティングリストを全て走査しなければならない、という弱点を克服したもの！
    - **top-k とかにすると検索は速くなるが、総数はわからなくなる！**

## sec 5

- 検索したデータの単位を決める
  - 1 SKU: Stock Keeping Unit
    - カラー３、サイズ３ → ９パターン登録する方法
- 更新されたデータの取得方法
  - 前回取得したファイルのうちで最新のものの更新日時
  - 収集対象のメタデータに含まれる更新情報
